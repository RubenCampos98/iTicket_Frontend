<app-navbar></app-navbar>

<div class="container" style="border: 0px solid blue;">
  <div class="row" style="border: 0px solid black;">
    <div class="col-12 col-lg-12" style="border: 0px solid red;">
      <h1>
        Definições
      </h1>
        <div class="card-body">
          <mat-tab-group dynamicHeight>

            <!----------------------------Serviços---------------------------->

            <mat-tab label="Serviços">
              <div class="top-table">
                <input [(ngModel)]="serviceSearchBar" class="form-control mt-2 mb-2 shadow-none" type="text" 
                placeholder="Pesquisar..." ngDefaultControl> 
                <button class="btn mt-2 mb-2 btn-primary">Adicionar</button>
              </div>
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Nome do serviço</th>
                    <th scope="col">Estado</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let data of allServiceData | searchBar: serviceSearchBar | slice: (page-1) * pageSize : page * pageSize">
                    <td style="width: 65%;">{{ data['name'] }}</td>
                    <td *ngIf="data['status']" style="width: 25%;">
                      <div class="form-check form-switch">
                        <input *ngIf="data['status'] == 'active'" class="form-check-input" type="checkbox" checked>
                        <input *ngIf="data['status'] == 'inactive'" class="form-check-input" type="checkbox">
                        <label class="form-check-label" for="flexSwitchCheckDefault">
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'active'" ngDefaultControl>Ativo</p>
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'inactive'" ngDefaultControl>Inativo</p>
                        </label>
                      </div>
                    </td>
                    <td *ngIf="!data['status']" style="width: 25%;"></td>
                    <td style="width: 10%;">
                      <img (click)="openServiceEditModal(data['id'], data['name'], data['status'] =='active')" 
                        src="../../../assets/icons/edit.svg"/>
                      <img (click)="openDeleteModal()" style="margin-left: 25%;" 
                      src="../../../assets/icons/trash.svg"/>
                    </td>
                  </tr>
                  <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" [attr.colspan]="allServiceData.length">
                      Sem informação a apresentar
                    </td>
                  </tr>
                  <div *ngIf="(allServiceData)?.length === 0">
                    <td style="width: 100%; font-size: 16px; ">
                      Não existem dados correspondentes
                    </td>
                  </div>
                </tbody>
              </table>
              <div class="bottom-table">
                <select class="form-select shadow-none" style="width: auto" [(ngModel)]="pageSize" 
                (ngModelChange)="ServiceTablePagination()" ngDefaultControl>
                  <option [ngValue]="5">Mostrar 5</option>
                  <option [ngValue]="10">Mostrar 10</option>
                  <option [ngValue]="15">Mostrar 15</option>
                </select>
                <ngb-pagination class="d-flex justify-content-right"
                  [rotate]="true"
                  [ellipses]="true"
                  [(page)]="page" 
                  [pageSize]="pageSize" 
                  [collectionSize]="allServiceData?.length"
                  (pageChange)="ServiceTablePagination()">
                  <ng-template ngbPaginationPrevious>Anterior</ng-template>
                  <ng-template ngbPaginationNext>Próximo</ng-template>
                  <ng-template ngbPaginationEllipsis>...</ng-template>
                </ngb-pagination>
              </div>
            </mat-tab>

            <!----------------------------Agendamentos---------------------------->

            <mat-tab label="Agendamentos">
              <div class="top-table">
                <input [(ngModel)]="bookingSearchBar" class="form-control mt-2 mb-2 shadow-none" type="text" 
                placeholder="Pesquisar..." ngDefaultControl> 
                <button class="btn mt-2 mb-2 btn-primary">Adicionar</button>
              </div>
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Nome</th>
                    <th scope="col">Email</th>
                    <th scope="col">Horário</th> 
                    <th scope="col">Serviço</th>
                    <th scope="col">Local</th>
                    <th scope="col">Notas</th>
                    <th scope="col">Estado</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let data of allBookingData | slice: (page-1) * pageSize : page * pageSize">
                    <td style="width: 15%;"> {{ data['name'] }} </td>
                    <td style="width: 15%;"> {{ data['email'] }} </td>
                    <td style="width: 15%;"> {{ data['start_time'] | date:'dd MMM yyyy - HH:mm aa' }} </td>
                    <td style="width: 15%;"> {{ data['service'].name }} </td>
                    <td style="width: 10%;"> {{ data['location'].address }} </td>
                    <td *ngIf="data['priority']" style="width: 10%;"> 
                    
                      <div class="form-check form-switch">
                        <input *ngIf="data['priority'] == 'priority'" class="form-check-input" type="checkbox"
                        style="border-color:#ffa600; background-color: #ffa600;" checked>
                        <input *ngIf="data['priority'] == 'normal'" class="form-check-input" type="checkbox" checked>
                        <label class="form-check-label" for="flexSwitchCheckDefault">
                          <p [(ngModel)]="isChecked" *ngIf="data['priority'] == 'priority'" ngDefaultControl>Prioritário</p>
                          <p [(ngModel)]="isChecked" *ngIf="data['priority'] == 'normal'" ngDefaultControl>Normal</p>
                        </label>
                      </div>
                    
                    </td>
                    <td *ngIf="data['status']" style="width: 10%;">
                      <div class="form-check form-switch">
                        <input *ngIf="data['status'] == 'confirmed'" class="form-check-input" type="checkbox" checked>
                        <input *ngIf="data['status'] == 'pending'" class="form-check-input" type="checkbox">
                        <input *ngIf="data['status'] == 'canceled'" class="form-check-input canceled" type="checkbox">
                        <label class="form-check-label" for="flexSwitchCheckDefault">
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'confirmed'" ngDefaultControl>Confirmado</p>
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'pending'" ngDefaultControl>Pendente</p>
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'canceled'" ngDefaultControl>Cancelado</p>
                        </label>
                      </div>
                    </td>
                    <td *ngIf="!data['status']" style="width: 10%;"></td>
                    <td style="width: 10%;">
                      <img src="../../../assets/icons/edit.svg"
                        (click)="openBookingEditModal(data['id'], data['name'], data['email'], data['start_time'], data['service'].name,
                        data['location'].address, data['priority'], data['status'], data['notes'])">
                      <img (click)="openDeleteModal()" style="margin-left: 25%;" 
                      src="../../../assets/icons/trash.svg"/>
                    </td>
                  </tr>
<!--                   <div *ngIf="(allBookingData | searchBar: bookingSearchBar)?.length === 0">
                    <td style="width: 100%; font-size: 16px; ">
                      Não existem dados correspondentes
                    </td>
                  </div> -->
                </tbody>
              </table>
              <div class="bottom-table">
                <select class="form-select shadow-none" style="width: auto" [(ngModel)]="pageSize" 
                (ngModelChange)="BookingTablePagination()" ngDefaultControl>
                  <option [ngValue]="5">Mostrar 5</option>
                  <option [ngValue]="10">Mostrar 10</option>
                  <option [ngValue]="15">Mostrar 15</option>
                </select>
                <ngb-pagination class="d-flex justify-content-right"
                  [rotate]="true"
                  [ellipses]="true"
                  [(page)]="page" 
                  [pageSize]="pageSize" 
                  [collectionSize]="allBookingData?.length"
                  (pageChange)="BookingTablePagination()">
                  <ng-template ngbPaginationPrevious>Anterior</ng-template>
                  <ng-template ngbPaginationNext>Próximo</ng-template>
                  <ng-template ngbPaginationEllipsis>...</ng-template>
                </ngb-pagination>
              </div>
            </mat-tab>

            <!----------------------------Localizações---------------------------->
            
            <mat-tab label="Localizações">
              <div class="top-table">
                <input [(ngModel)]="locationSearchBar" class="form-control mt-2 mb-2 shadow-none"
                type="text" placeholder="Pesquisar..." ngDefaultControl> 
                <button class="btn mt-2 mb-2 btn-primary">Adicionar</button>
              </div>
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Morada</th>
                    <th scope="col">Notas</th>
                    <th scope="col">Estado</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let data of allLocationData | slice: (page-1) * pageSize : page * pageSize">
                    <td style="width: 25%;">{{ data['address'] }}</td>
                    <td style="width: 40%;">{{ data['notes'] }}</td>
                    <td *ngIf="data['status']" style="width: 25%;">
                      <div class="form-check form-switch">
                        <input *ngIf="data['status'] == 'active'" class="form-check-input" type="checkbox" checked>
                        <input *ngIf="data['status'] == 'inactive'" class="form-check-input" type="checkbox">
                        <label class="form-check-label" for="flexSwitchCheckDefault">
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'active'" ngDefaultControl>Ativo</p>
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'inactive'" ngDefaultControl>Inativo</p>
                        </label>
                      </div>
                    </td>
                    <td *ngIf="!data[('status')]" style="width: 25%;"></td>
                    <td style="width: 10%;">
                      <img (click)="openLocationEditModal(data['id'], data['address'], data['status'] == 'active', data['notes'])" 
                      src="../../../assets/icons/edit.svg">
                      <img (click)="openDeleteModal()" style="margin-left: 25%;" src="../../../assets/icons/trash.svg">
                    </td>
                  </tr>
<!--                   <div *ngIf="(allLocationData | searchBar: locationSearchBar)?.length === 0">
                    <td style="width: 100%; font-size: 16px; ">
                      Não existem dados correspondentes
                    </td>
                  </div> -->
                </tbody>
              </table>
              <div class="bottom-table">
                <select class="form-select shadow-none" style="width: auto" [(ngModel)]="pageSize" 
                (ngModelChange)="LocationTablePagination()" ngDefaultControl>
                  <option [ngValue]="5">Mostrar 5</option>
                  <option [ngValue]="10">Mostrar 10</option>
                  <option [ngValue]="15">Mostrar 15</option>
                </select>
                <ngb-pagination class="d-flex justify-content-right"
                  [rotate]="true"
                  [ellipses]="true"
                  [(page)]="page" 
                  [pageSize]="pageSize" 
                  [collectionSize]="allLocationData?.length"
                  (pageChange)="LocationTablePagination()">
                  <ng-template ngbPaginationPrevious>Anterior</ng-template>
                  <ng-template ngbPaginationNext>Próximo</ng-template>
                  <ng-template ngbPaginationEllipsis>...</ng-template>
                </ngb-pagination>
              </div>
            </mat-tab>

            <!----------------------------Utilizadores---------------------------->

            <mat-tab label="Utilizadores">
              <div class="top-table">
                <input [(ngModel)]="userSearchBar" class="form-control mt-2 mb-2 shadow-none" type="text"
                placeholder="Pesquisar..." ngDefaultControl> 
                <button class="btn mt-2 mb-2 btn-primary">Adicionar</button>
              </div>
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Nome</th>
                    <th scope="col">Email</th>
                    <th scope="col">Contacto</th>
                    <th scope="col">Cargo</th>
                    <th scope="col">Estado</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let data of allUserData | slice: (page-1) * pageSize : page * pageSize">
                    <td style="width: 25%;">{{ data['name'] }}</td>
                    <td style="width: 20%;">{{ data['email'] }}</td>
                    <td style="width: 15%;">{{ data['phone'] }}</td>
                    <td *ngIf="data['admin']" style="width: 15%;">
                      <div class="form-check form-switch">
                        <input *ngIf="data['admin'] == true" class="form-check-input" type="checkbox" checked>
                        <input *ngIf="data['admin'] == null" class="form-check-input" type="checkbox">
                        <label class="form-check-label" for="flexSwitchCheckDefault">
                          <p [(ngModel)]="isChecked" *ngIf="data['admin'] == true" ngDefaultControl>Administrador</p>
                          <p [(ngModel)]="isChecked" *ngIf="data['admin'] == false" ngDefaultControl>Funcionário</p>
                        </label>
                      </div>
                    </td>
                    <td *ngIf="!data['admin']" style="width: 15%;"></td>
                    <td style="width: 15%;">{{ data['admin'] }}</td>
                    <td style="width: 10%;">
                      <img src="../../../assets/icons/edit.svg"
                      (click)="openUserEditModal(data['id'], data['name'], data['email'], data['phone'], data['admin'])">
                      <img (click)="openDeleteModal()" style="margin-left: 25%;" 
                      src="../../../assets/icons/trash.svg">
                    </td>
                  </tr>
<!--                   <div *ngIf="(allUserData | searchBar: userSearchBar)?.length === 0">
                    <td style="width: 100%; font-size: 16px; ">
                      Não existem dados correspondentes
                    </td>
                  </div> -->
                </tbody>
              </table>    
              <div class="bottom-table">
                <select class="form-select shadow-none" style="width: auto" [(ngModel)]="pageSize1" 
                (ngModelChange)="LocationTablePagination()" ngDefaultControl>
                  <option [ngValue]="5">Mostrar 5</option>
                  <option [ngValue]="10">Mostrar 10</option>
                  <option [ngValue]="15">Mostrar 15</option>
                </select>
                <ngb-pagination class="d-flex justify-content-right"
                  [rotate]="true"
                  [ellipses]="true"
                  [(page)]="page" 
                  [pageSize]="pageSize" 
                  [collectionSize]="allUserData?.length"
                  (pageChange)="LocationTablePagination()">
                  <ng-template ngbPaginationPrevious>Anterior</ng-template>
                  <ng-template ngbPaginationNext>Próximo</ng-template>
                  <ng-template ngbPaginationEllipsis>...</ng-template>
                </ngb-pagination>
              </div>    
            </mat-tab>

            <!----------------------------Senhas---------------------------->

            <mat-tab label="Senhas">
              <div class="top-table">
                <input class="form-control mt-2 mb-2 shadow-none" type="text" placeholder="Pesquisar..." /> 
                <button class="btn mt-2 mb-2 btn-primary">Adicionar</button>
              </div>
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Nº Senha</th>
                    <th scope="col">Fila</th>
                    <th scope="col">Duração</th>
                    <th scope="col">Notas</th>
                    <th scope="col">Tipo Atendimento</th>
                    <th scope="col">Estado</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let data of allTicketData | slice: (page-1) * pageSize : page * pageSize">
                    <td style="width: 10%;">{{ data['number'] }}</td>
                    <td style="width: 10%;">{{ data['waiting_list'].name }}</td>
                    <td style="width: 15%;">{{ data['duration'] | date:'HH:mm'  }}</td>
                    <td style="width: 25%;">{{ data['notes'] }}</td>

                    <td *ngIf="data['priority']" style="width: 15%;">
                      <div class="form-check form-switch">
                        <input *ngIf="data['priority'] == 'normal'" class="form-check-input" type="checkbox" checked>
                        <input *ngIf="data['priority'] == 'priority'" class="form-check-input canceled"
                        style="border-color:#ffa600; background-color: #ffa600;" type="checkbox" checked>
                        <label class="form-check-label" for="flexSwitchCheckDefault">
                          <p [(ngModel)]="isChecked" *ngIf="data['priority'] == 'priority'" ngDefaultControl>Prioritário</p>
                          <p [(ngModel)]="isChecked" *ngIf="data['priority'] == 'normal'" ngDefaultControl>Normal</p>
                        </label>
                      </div>
                    </td>

                    <td *ngIf="data['status']" style="width: 15%;">
                      <div class="form-check form-switch">
                        <input *ngIf="data['status'] == 'pending'" class="form-check-input" type="checkbox" checked>
                        <input *ngIf="data['status'] == 'finished'" class="form-check-input canceled"
                        style="border-color:#f41414; background-color: #f41414;" type="checkbox" checked>
                        <label class="form-check-label" for="flexSwitchCheckDefault">
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'pending'" ngDefaultControl>Pendente</p>
                          <p [(ngModel)]="isChecked" *ngIf="data['status'] == 'finished'" ngDefaultControl>Terminado</p>
                        </label>
                      </div>
                    </td>
                    <td *ngIf="!data['status']" style="width: 15%;"></td>
                    <td style="width: 10%;">
                      <img src="../../../assets/icons/edit.svg"
                      (click)="openTicketEditModal(data['id'], data['number'], data['waiting_list'].name, data['duration'],
                       data['notes'], data['priority'], data['status'])">
                      <img style="margin-left: 25%;" (click)="openDeleteModal()"
                      src="../../../assets/icons/trash.svg">
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="bottom-table">
                <select class="form-select shadow-none" style="width: auto" [(ngModel)]="pageSize" 
                (ngModelChange)="TicketTablePagination()" ngDefaultControl>
                  <option [ngValue]="5">Mostrar 5</option>
                  <option [ngValue]="10">Mostrar 10</option>
                  <option [ngValue]="15">Mostrar 15</option>
                </select>
                <ngb-pagination class="d-flex justify-content-right"
                  [rotate]="true"
                  [ellipses]="true"
                  [(page)]="page" 
                  [pageSize]="pageSize" 
                  [collectionSize]="allTicketData?.length"
                  (pageChange)="TicketTablePagination()">
                  <ng-template ngbPaginationPrevious>Anterior</ng-template>
                  <ng-template ngbPaginationNext>Próximo</ng-template>
                  <ng-template ngbPaginationEllipsis>...</ng-template>
                </ngb-pagination>
              </div>
            </mat-tab>
          </mat-tab-group>
        </div>
      </div>
    </div>
  </div>

  <app-edit-service-modal #editService></app-edit-service-modal>
  <app-edit-booking-modal #editBooking></app-edit-booking-modal>
  <app-edit-location-modal #editLocation></app-edit-location-modal>
  <app-edit-user-modal #editUser></app-edit-user-modal>
  <app-edit-ticket-modal #editTicket></app-edit-ticket-modal>
